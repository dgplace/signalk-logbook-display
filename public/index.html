<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <title>Logbook</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <br>
  <div class="container" data-mobile-view="table">
    <div class="mobile-tab-bar" id="mobileTabBar" role="tablist" aria-label="View toggle">
      <button id="mobileTabTable" class="mobile-tab is-active" type="button" role="tab" aria-selected="true" aria-controls="tablePanel">
        Voyages
      </button>
      <button id="mobileTabMap" class="mobile-tab" type="button" role="tab" aria-selected="false" aria-controls="mapPanel">
        Map
      </button>
    </div>
    <div class="top-section" id="tablePanel" role="tabpanel" aria-labelledby="mobileTabTable">
      <div class="header-bar">
        <h3 style="margin: 16px 0;"><a href="/logbook" style="text-decoration: none; color: inherit;">Logbook SV Tequila Mockingbird</a></h3>
        <div class="header-actions">
          <label class="toggle-switch" id="layoutOverrideToggleWrapper">
            <input type="checkbox" id="layoutOverrideToggle" aria-label="Force tab layout">
            <span class="toggle-slider" aria-hidden="true"></span>
            <span class="toggle-text">Tab View</span>
          </label>
          <button id="toggleMaxBtn" aria-pressed="false">Maximize</button>
          <button id="regenBtn">Regenerate voyages</button>
          <button type="button" id="manualToggleBtn">Add voyage</button>
          <!--<button id="regenPolarBtn">Regenerate polar</button>-->
        </div>
      </div>
      <div class="table-wrapper">
        <table id="voyTable">
          <thead>
            <tr>
              <th class="expander-col" style="width:8px;"></th>
              <th class="idx-col">#</th>
              <th>Start</th>
              <th class="end-col">End</th>
              <th>NM</th>
              <th class="total-time-col">Duration</th>
              <th>Max<br>Speed</th>
              <th class="avg-speed-col">Avg<br>Speed</th>
              <th>Max<br>Wind</th>
              <th class="avg-wind-col">Avg<br>Wind</th>
              <th>Wind<br>Dir</th>
              <th class="manual-edit-col">Edit</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <div id="hDivider" class="h-divider" role="separator" aria-orientation="horizontal" aria-label="Resize panels"></div>
    <div class="map-row" id="mapPanel" role="tabpanel" aria-labelledby="mobileTabMap">
      <div id="map"></div>
      
      <section class="manual-voyage-panel details-panel" id="manualVoyagePanel" aria-label="Manual voyage entry" hidden style="right: auto; left: 12px; top: 12px; max-width: 380px; z-index: 1500; display: none;">
        <div class="floating-header">
           <span class="drag-handle" aria-hidden="true">‚ãÆ‚ãÆ</span>
           <span class="floating-title" id="manualPanelTitle">Manual voyage</span>
           <button type="button" class="close-details" id="manualCloseBtn" aria-label="Close">√ó</button>
        </div>
        <div class="details-body">
            <p id="manualPanelSubtitle" style="display:none">Add voyages that do not exist in the logbook parser output.</p>
            <form id="manualVoyageForm">
              <div class="manual-trip-type">
                <fieldset aria-label="Trip type">
                  <label>
                    <input type="radio" id="manualDayTripInput" name="manualTripType" value="day">
                    <span>Day trip</span>
                  </label>
                  <label>
                    <input type="radio" id="manualOvernightInput" name="manualTripType" value="overnight" checked>
                    <span>Overnights</span>
                  </label>
                </fieldset>
              </div>
              <div class="manual-tabs">
                <div class="manual-tablist" id="manualTabList" role="tablist" aria-label="Manual voyage locations"></div>
                <button type="button" class="manual-tab-add" id="manualAddStopBtn" title="Add Anchorage">+</button>
              </div>
              <div class="manual-tab-panels" id="manualTabPanels"></div>
              <template id="manualLocationTemplate">
                <section class="manual-group manual-location-panel" role="tabpanel">
                  <button type="button" class="manual-remove-btn" aria-label="Remove stop" title="Remove">√ó</button>
                  <div class="manual-row-group">
                    <label class="manual-time-field">
                      Date/time
                      <input type="datetime-local" class="manual-time-input" required>
                    </label>
                    <div class="manual-location-input-group">
                      <label class="manual-location-label">
                        <span>Location</span>
                        <input type="text" class="manual-name-input" list="manualLocationList" required placeholder="Name">
                      </label>
                      <div class="manual-pick">
                        <button type="button" class="manual-pick-btn" title="Pick on map">üìç</button>
                      </div>
                    </div>
                  </div>
                  <div class="manual-coords" hidden style="display:none">
                    <label>
                      Lat
                      <input type="number" class="manual-lat-input" step="0.000001" min="-90" max="90" inputmode="decimal" placeholder="-27.470125">
                    </label>
                    <label>
                      Long
                      <input type="number" class="manual-lon-input" step="0.000001" min="-180" max="180" inputmode="decimal" placeholder="153.021072">
                    </label>
                  </div>
                </section>
              </template>
              <datalist id="manualLocationList"></datalist>
              <div class="manual-metrics">
                <div class="manual-metric">
                  <span>Distance</span>
                  <strong id="manualDistance">‚Äî</strong>
                </div>
                <div class="manual-metric">
                  <span>Duration</span>
                  <strong id="manualDuration">‚Äî</strong>
                </div>
              </div>
              <div class="manual-route-editor" id="manualRouteEditor" hidden>
                <div class="manual-route-controls">
                  <label class="toggle-switch manual-route-toggle" id="manualRouteToggleWrapper">
                    <input type="checkbox" id="manualRouteToggle" aria-label="Edit day trip loop on map">
                    <span class="toggle-slider" aria-hidden="true"></span>
                    <span class="toggle-text">Edit path</span>
                  </label>
                  <button type="button" class="manual-secondary-btn" id="manualRouteResetBtn">Reset</button>
                </div>
                <p class="manual-route-hint" id="manualRouteHint">
                  Drag points to move. Dbl-click to remove.
                </p>
              </div>
              <div class="manual-actions">
                <button type="submit" id="manualAddBtn">Save</button>
                <button type="reset" class="manual-secondary-btn">Clear</button>
                <button type="button" class="manual-danger-btn" id="manualDeleteBtn" hidden>Delete</button>
              </div>
            </form>
        </div>
      </section>

      <div id="pointDetails" class="details-panel" aria-live="polite">
        <div class="floating-header">
          <span class="drag-handle" aria-hidden="true">‚ãÆ‚ãÆ</span>
          <span class="floating-title">Overlays</span>
          <button class="close-details" aria-label="Close">√ó</button>
        </div>
        <div class="details-controls">
          <label class="toggle-switch" id="openSeaMapToggleWrapper">
            <input type="checkbox" id="openSeaMapToggle" aria-label="Toggle nautical chart overlay">
            <span class="toggle-slider" aria-hidden="true"></span>
            <span class="toggle-text">Nautical</span>
          </label>
          <label class="toggle-switch" id="windOverlayToggleWrapper">
            <input type="checkbox" id="windOverlayToggle" aria-label="Toggle wind overlay">
            <span class="toggle-slider" aria-hidden="true"></span>
            <span class="toggle-text">Wind</span>
          </label>
        </div>
        <div class="details-body"></div>
      </div>
    </div>
  </div>

  <div id="loadingOverlay" aria-hidden="true">
    <div class="loading-content" role="status" aria-live="polite">
      <div class="loading-indicator" aria-hidden="true"></div>
      <div class="loading-message">Working...</div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
