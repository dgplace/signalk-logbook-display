<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <title>Logbook</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <br>
  <div class="container" data-mobile-view="table">
    <div class="mobile-tab-bar" id="mobileTabBar" role="tablist" aria-label="View toggle">
      <button id="mobileTabTable" class="mobile-tab is-active" type="button" role="tab" aria-selected="true" aria-controls="tablePanel">
        Voyages
      </button>
      <button id="mobileTabMap" class="mobile-tab" type="button" role="tab" aria-selected="false" aria-controls="mapPanel">
        Map
      </button>
    </div>
    <div class="top-section" id="tablePanel" role="tabpanel" aria-labelledby="mobileTabTable">
      <div class="header-bar">
        <h3 style="margin: 16px 0;">Logbook SV Tequila Mockingbird</h3>
        <div class="header-actions">
          <label class="toggle-switch" id="layoutOverrideToggleWrapper">
            <input type="checkbox" id="layoutOverrideToggle" aria-label="Force tab layout">
            <span class="toggle-slider" aria-hidden="true"></span>
            <span class="toggle-text">Tab View</span>
          </label>
          <button id="toggleMaxBtn" aria-pressed="false">Maximize</button>
          <button id="regenBtn">Regenerate voyages</button>
          <!--<button id="regenPolarBtn">Regenerate polar</button>-->
        </div>
      </div>
      <div class="table-wrapper">
        <table id="voyTable">
          <thead>
            <tr>
              <th class="expander-col" style="width:8px;"></th>
              <th class="idx-col">#</th>
              <th>Start</th>
              <th class="end-col">End</th>
              <th>NM</th>
              <th class="total-time-col">Duration</th>
              <th>Max<br>Speed</th>
              <th class="avg-speed-col">Avg<br>Speed</th>
              <th>Max<br>Wind</th>
              <th class="avg-wind-col">Avg<br>Wind</th>
              <th>Wind<br>Dir</th>
              <th class="manual-edit-col">Edit</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="manual-toggle">
          <button type="button" id="manualToggleBtn">Add manual voyage</button>
        </div>
        <section class="manual-voyage-panel" id="manualVoyagePanel" aria-label="Manual voyage entry" hidden>
          <div class="manual-panel-header">
            <div>
              <h4 id="manualPanelTitle">Manual voyage</h4>
              <p id="manualPanelSubtitle">Add voyages that do not exist in the logbook parser output.</p>
            </div>
            <button type="button" class="manual-close-btn" id="manualCloseBtn">Close</button>
          </div>
          <form id="manualVoyageForm">
            <div class="manual-tabs">
              <div class="manual-tablist" id="manualTabList" role="tablist" aria-label="Manual voyage locations"></div>
              <button type="button" class="manual-tab-add" id="manualAddStopBtn">Add stop</button>
            </div>
            <div class="manual-tab-panels" id="manualTabPanels"></div>
            <template id="manualLocationTemplate">
              <section class="manual-group manual-location-panel" role="tabpanel">
                <div class="manual-group-title">Start</div>
                <label>
                  Date/time
                  <input type="datetime-local" class="manual-time-input" required>
                </label>
                <label>
                  Location
                  <input type="text" class="manual-name-input" list="manualLocationList" required placeholder="e.g. Moreton Bay">
                </label>
                <div class="manual-coords">
                  <label>
                    Lat
                    <input type="number" class="manual-lat-input" required step="0.000001" min="-90" max="90" inputmode="decimal" placeholder="-27.470125">
                  </label>
                  <label>
                    Long
                    <input type="number" class="manual-lon-input" required step="0.000001" min="-180" max="180" inputmode="decimal" placeholder="153.021072">
                  </label>
                </div>
                <div class="manual-pick">
                  <button type="button" class="manual-pick-btn">Pick on map</button>
                  <span class="manual-pick-hint" hidden>Click on the map to set coordinates.</span>
                </div>
                <div class="manual-location-actions">
                  <button type="button" class="manual-remove-btn">Remove stop</button>
                </div>
              </section>
            </template>
            <datalist id="manualLocationList"></datalist>
            <div class="manual-metrics">
              <div class="manual-metric">
                <span>Distance</span>
                <strong id="manualDistance">—</strong>
              </div>
              <div class="manual-metric">
                <span>Duration</span>
                <strong id="manualDuration">—</strong>
              </div>
            </div>
            <div class="manual-actions">
              <button type="submit" id="manualAddBtn">Add manual voyage</button>
              <button type="reset" class="manual-secondary-btn">Clear</button>
              <button type="button" class="manual-danger-btn" id="manualDeleteBtn" hidden>Delete manual voyage</button>
            </div>
          </form>
        </section>
      </div>
    </div>
    <div id="hDivider" class="h-divider" role="separator" aria-orientation="horizontal" aria-label="Resize panels"></div>
    <div class="map-row" id="mapPanel" role="tabpanel" aria-labelledby="mobileTabMap">
      <div id="map"></div>
      <div id="pointDetails" class="details-panel" aria-live="polite">
        <div class="floating-header">
          <span class="drag-handle" aria-hidden="true">⋮⋮</span>
          <span class="floating-title">Point Details</span>
          <button class="close-details" aria-label="Close">×</button>
        </div>
        <div class="details-controls">
          <label class="toggle-switch" id="windOverlayToggleWrapper">
            <input type="checkbox" id="windOverlayToggle" aria-label="Toggle wind overlay">
            <span class="toggle-slider" aria-hidden="true"></span>
            <span class="toggle-text">Wind overlay</span>
          </label>
        </div>
        <div class="details-body"></div>
      </div>
    </div>
  </div>

  <div id="loadingOverlay" aria-hidden="true">
    <div class="loading-content" role="status" aria-live="polite">
      <div class="loading-indicator" aria-hidden="true"></div>
      <div class="loading-message">Working...</div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
